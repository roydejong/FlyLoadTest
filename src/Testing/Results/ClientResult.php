<?php

namespace FlyPHP\LoadTester\Testing\Results;

use FlyPHP\Http\StatusCode;

/**
 * A result object generated by a test client request.
 */
class ClientResult
{
    /**
     * The client ID
     *
     * @var int
     */
    public $clientId;

    /**
     * Was the client able to connect?
     *
     * @var bool
     */
    public $connected = false;

    /**
     * Was the client able to send a request?
     *
     * @var bool
     */
    public $sent = false;

    /**
     * The client result code
     *
     * @var int
     */
    public $resultCode = null;

    /**
     * Was the attempt aborted due to a timeout?
     *
     * @var bool
     */
    public $timedOut = false;

    /**
     * Request start time.
     *
     * @var float
     */
    public $startTime = 0.0;

    /**
     * Request end time.
     *
     * @var float
     */
    public $endTime = 0.0;

    /**
     * Decribes the result.
     *
     * @return string
     */
    public function __toString()
    {
        $runTime = $this->endTime - $this->startTime;

        $str = "({$this->clientId}) ";

        if (!$this->connected) {
            $str .= " [***] Connect failed";
        } else if ($this->timedOut) {
            $str .= " [---] Timeout occurred, no (valid) response received";
        } else if (!$this->sent) {
            $str .= " [---] Send failed";
        } else if ($this->resultCode === null) {
            $str .= " [???] No status code received - unknown status";
        } else {
            $str .= " [{$this->resultCode}] ";
            $str .= StatusCode::getMessageForCode($this->resultCode);
        }

        $roundedRuntime = round($runTime, 3);
        $str .= " ({$roundedRuntime}sec)";
        return $str;
    }
}